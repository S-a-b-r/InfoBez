# Основные виды угроз и нарушителей, построение безопасного протокола передач на HTTP

## Виды нарушителей

## По характеру действий

### Пассивный
> Нарушитель, не предпринимающий действий по дезорганизации криптографического протокола. Его целью является перехват сообщений в криптосистеме с целью ознакомления с их содержанием, вычисления распределяемых ключей, раскрытия тайны голосования или результатов жеребьевки.

### Активный
> Нарушитель, который пытается навязать ложные сообщения, перехватывать и модифицировать сообщения, получить доступ к базам данных, расширить свои полномочия, навязать ложный открытый ключ, подготовить фиктивные документы и т.д.

Отсюда виды атак ***Пассивная*** и ***Активная***


## По характеру взаимоотношений с оргонизацией

## Внутренние
> Внутренним нарушителем является лицо, имеющее определенные легальные полномочия внутри организации, подвергающейся нападению, или участник криптографического протокола, пытающийся нанести определенный ущерб другим участникам криптографического протокола.

## Внешние
> Внешним нарушителем является лицо, не связанное с организацией, подвергающейся нападению

Отсюда виды атак ***Внешние*** и ***Внутренние***

## Безопасный протокол передач.
При построении безопастной системы предполагаем наихудший вариант: нарушитель может читать все сообщения, может их менять, есть доступ к каналу связи.

### Начнем с регистрации. 
Если передать в прямом виде (не важно, через куки, гет или пост запрос) пароль и логин, злоумышленник получит всю информацию о данных для входа, после чего сможет без проблем зайти в аккаунт. Чтобы этого не произошло, клиент передает бэку два параметра при регистрации 
1. login
2. hash(login + password). 

На бэкенде в БД записываются эти данные, логин в явном виде и пароль как hash(login + password) (они пригодятся нам для авторизации). В таком случае злоумышленник будет знать только логин, а пароль по хешу он восстановить никак не сможет, и хеш от конкатинации логина и пароля злоумышленнику ничего не даст.

### Авторизация
Тут все то же самое, что и при регистрации. Передавать в прямом виде ничего нельзя. Аторизация происходит по следующему принципу:
передаем с фронта следующие параметры на бэк:
1. login
2. Случайное число, сгенерированное на фронте
3. hash ( hash( login + введенный пароль) + случайное число из 2ого пункта)

На бэкенде происходит сверка данных. По логину в бд находим пользователя, берем его пароль, который является hash( login + password). Для удобства обозначу его PASSWORD. И на бэкенде происходит операция из пунка 3, только вместо hash( login + введеный пароль) мы используем PASSWORD. Если итоговые данные совпадают, то авторизация прошла успешно. 

Что обычно происходит далее? Бэкенд присылает фронтенду какой-то токен, с помощью которого происходит подпись всех следующих запросов. Но т.к. злоумышленник может перехватывать все наши данные, он может перехватить и этот токен. Поэтому мы не передаем с бэкенда токен, а отвечаем фронтенду, окей, ты авторизовался успешно, и прысылает ему случайное число, сгенерированное бэком и записанное в таблицу использованных чисел (числа должны быть уникальны). После чего фронтенд и бэкенд не обмениваясь информацией формируют токен имеющий следующий вид: 

hash( login + Случайное число с бэка + hash() + date).
> Вообще, наверное, тут может быть любой токен, главное, чтобы он как-то зависле от логина и этого случайного числа с бэка.

А далее начинается веселуха. Как пердавать параметры и подтвержать их токеном, который нельзя показывать? ПРАВИЛЬНО, ПЕРЕДАВАЯ ЕГО В ХЕШЕ)

А теперь внимательно, сейчас будет многа букав Фронтенд передает на бэк 
1. Зашифрованное тело запроса(параметры запроса) Любым из стойких алгоритмов (секретным ключом служит токен).
2. hash ( первый пункт + token)
> У меня тут еще написано рандомное число в хеше, но нахуй оно нужно, я не понял

А теперь поясняю, что мы только что сделали и чего добились данным алгоритмом. Бэкенд может проверить ЛЮБОЙ запрос на целостность и неизменность, если кто-то на фронтенде послал тебя нахуй, ты увидишь, что тебя послали нахуй, и никакой злой хакер не сможет подменить это сообщение на "Я люблю тебя, мой дорогой бэкендер". И так на любом этапе. А за счет кодирования параметров и ключа, который хакер в лицо не видел, информацию он даже не увидит. Итого, злоумышленник может узнать только то, что твой логин в твоей любимой игре Nagibator322 и всео.
 
